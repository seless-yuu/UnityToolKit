## SpecStory

## Unityアプリケーション基盤の設計相談 (2025/2/12 20:33:07)

_**User**_

現在記述しているUnityエンジン上のアプリケーション基盤について相談です
アプリケーションレイヤーはこの基盤に含めるべきではありませんが、記述方式をどうするか検討しています
それは逐次的なシナリオ記述か、状態遷移だと考えています
これはまず合っていますか？
また、その場合方法は逐次的なものはLua、状態遷移図の場合はVisualScriptingが適していると考えていますが見解を相談したいです

---

_**Assistant**_

以下、私の見解になります。

---

**基本的な考え方について**

- **逐次的なシナリオ記述：**  
  アプリケーションの流れを直線的に記述するアプローチは、シンプルなケースや分岐が少ない場合に有効です。Luaのような動的なスクリプト言語は、実行時の柔軟性やホットリロードの利便性があるため、こうしたシナリオ記述には適しています。

- **状態遷移管理：**  
  状態遷移が複雑になってくると、「どの状態からどの状態に遷移するか」を視覚的に把握した方が管理しやすくなります。こうした場合、VisualScriptingなどのビジュアルツールは、状態間の関係や遷移条件を直感的に整理できるため、適切な選択肢となります。

---

**アプリケーション基盤としての視点**

なお、今回意図しているのはアプリケーション「基盤」の設計であり、アプリケーションレイヤーのコード自体は含めないという前提があります。したがって、以下の点にも留意してください。

- 基盤側では、あくまでシステムの「フレームワーク」を組むという観点から、各アプローチ（逐次シナリオ記述と状態遷移）のためのインターフェースやイベント駆動の仕組みを提供することが望ましいです。
- 実際のアプリケーションレイヤーでどちらの方式を採用するか（または場合によって両方を組み合わせるか）は、要件やチームのスキルセット、開発・テストの容易さなどを考慮して選定することが重要です。

---

**総括**

質問の趣旨である「逐次的なシナリオ記述か、状態遷移か」という観点は、基本的には問題ありません。  
- **単純な流れやシナリオ記述の場合：** Luaなどのスクリプト言語が手軽で柔軟な実装手法となるでしょう。  
- **複雑な状態管理が必要な場合：** VisualScriptingによる状態遷移図の利用は直感的な設計・デバッグが可能で有用です。

どちらの方法も適切なシナリオに合わせて選択すればよいと思います。さらに、双方の特徴を活かし、必要に応じて組み合わせるというのもひとつのアプローチとなります。

---

_**User**_

前提として、今回は生成AI(CursorのComposerエージェント)を軸に開発を行います
生成AIフレンドリーな記述が必要と考えており、テキストデータが主であることが重要になると思います
この考えは妥当でしょうか

---

_**Assistant**_

以下は私の見解です。

---

**生成AIフレンドリーな記述とテキストデータ中心設計の考え**

- **生成AIはテキストに特化している:**  
  生成AI（例えばCursorのComposerエージェント）は、基本的にテキストデータを入力として扱い、テキスト出力を生成するモデルです。そのため、システムやデータ構造もテキストベースで記述されていると、AIが解析しやすく、柔軟に対応できる可能性が高まります。

- **柔軟性と拡張性:**  
  テキストデータ中心の設計は、後からの変更や拡張がしやすいというメリットもあります。生成AIに指示を出す際も、テキストとしての入力が明確であれば、その内容を動的に変更したり、バリエーションを持たせたりするのが容易です。

- **システム設計との整合性:**  
  アプリケーション基盤の設計において、生成AIの特性（テキスト中心、動的変化への対応など）を考慮するのは妥当です。特に、アプリケーションレイヤーの動作シナリオや状態遷移をテキストで記述することで、生成AIが容易に解釈・生成できる環境が整うと考えられます。

---

**結論**  
今回の設計方針として、生成AIフレンドリーな記述方式を採用し、テキストデータを主軸とする考えは非常に妥当です。このアプローチは、生成AIを活用した開発パイプラインや、柔軟なシナリオ、状態管理といった側面でも大いにメリットをもたらすでしょう。

---

_**User**_

ありがとうございます
とすると、アプリケーションレイヤーに方針を引き継ぐとするとLuaは問題ありませんがVisualScriptingが懸念になります
UnityのVisualScriptingはテキストとして表現されているでしょうか？

---

_**Assistant**_

以下、私の見解になります。

---

**UnityのVisualScriptingのデータ保存形式について**

UnityのVisualScripting（以前のBoltなど）は、エディタ上でノードベースのグラフを用いてロジックを組み立てる仕組みです。これらのグラフはプロジェクト内のアセットとして保存されますが、その保存形式は以下のような特性があります。

- **シリアライズ方式:**  
  Unityでは、シーンやアセットを保存する際にYAML形式などのテキストベースのシリアライズが選択できる設定（「Force Text」シリアリゼーション）が存在します。そのため、VisualScriptingのグラフもテキスト形式で保存される場合があります。

- **生成AIとの観点:**  
  たとえYAML形式などのテキストデータで保存されていたとしても、これらはUnity内部のシリアライズ仕様に沿った構造となっており、生成AIが直接「意味のある」シナリオ記述として扱うには適していない可能性があります。  
  一方で、Luaのスクリプトは人間向けにも可読性が高く、生成AIが理解しやすい形（つまり、シンプルな命令文やロジックの記述）として利用できます。

---

**結論**

- UnityのVisualScriptingのグラフは、設定によってはテキスト（YAMLなど）として保存されますが、その形式はUnityの内部仕様に依存しており、生成AIが直接編集・生成する用途にはあまり向いていない可能性があります。  
- そのため、生成AIフレンドリーな記述を求めるのであれば、Luaなどのスクリプト言語の方が適していると言えるでしょう。

---

_**User**_

ありがとうございます
上記観点からまずはLua実装を優先するとします
VisualScriptingはその後にしましょう

ちなみに、Prefab形式に関して生成AIは自動生成に不向きでしょうか

---

_**Assistant**_

生成AIがPrefab形式の自動生成に対して苦手な面がある点について、以下のように考えられます。

---

### Prefabの特性

- **内部構造の複雑性:**  
  UnityのPrefabは、コンポーネントの構成や依存関係、シーン内での参照など多くの内部情報を持っています。これらの情報はUnityエディタ上の操作やシリアライズ仕様に強く依存しており、単純なテキストでは表現しきれない複雑な構造を持っています。

- **テキスト形式での保存:**  
  Unityの設定で「Force Text」シリアライゼーションを有効にしていれば、PrefabはYAML形式のテキストとして保存されます。これは一見、テキスト生成に適しているように思われますが、実際にはUnity内のメタデータや特有のシリアライズ仕様が絡んでいるため、生成AIが直接意味のあるPrefabを生成するのは難しいです。

---

### 生成AIとの相性

- **生成AIの得意領域:**  
  生成AIは、抽象度の高いテキストや自然言語形式のシナリオ、ロジック記述には強みを発揮します。しかし、Prefabのような細かな依存関係や内部仕様に踏み込んだテキスト生成は、専門的な知識が無いと正確な出力が難しいケースが多いです。

- **自動生成の難しさ:**  
  PrefabのYAMLファイルは、ほとんどがUnityの内部的なシリアライズ仕様に基づいて構成されており、各種コンポーネントや設定の整合性維持が必要です。生成AIがこれらを適切に踏まえて出力するのは、現時点ではリスクと手間が伴う可能性があります。

---

### 結論

- **技術的にはテキスト形式ではあるが…**  
  UnityのPrefabはテキスト（YAML）で保存されるため、一見生成AIで出力できそうな形式ではあります。しかし、その内部に含まれる複雑な依存関係やメタデータの管理が問題となり、生成AIによる自動生成は容易ではありません。

- **現実的なアプローチとしては…**  
  Prefabの自動生成を目指すなら、生成AIによる直接生成ではなく、ある程度テンプレートや補助ツールを用意して、生成されたテキストを後処理する仕組みが必要となるでしょう。  
  そのため、Prefabの自動生成は生成AI単独で行うには現実的でない可能性が高く、手動編集または専用ツールを併用するのが望ましいと考えられます。

---

以上の理由から、Prefab形式に関しては生成AIによる自動生成は、現状では不向きと考えるのが妥当です。

---

_**User**_

了解です。おそらくPrefabの直接記述ではなくそのジェネレータコードを記述してもらうのが良さそうですね

---

_**Assistant**_

はい、その通りです。

Prefab自体を直接記述するのではなく、Prefabを生成するためのジェネレータコード（C#スクリプトなど）を記述するアプローチは、生成AIの強みであるテキスト生成能力と相性が良いです。

この方法では、以下のメリットがあります。

- **柔軟なテンプレート化:**  
  生成AIから得られるテキストデータを元に、パラメータや設定情報を適用することで、様々なPrefabの自動生成が可能になります。

- **保守性の向上:**  
  直接Prefabを生成するのではなく、生成ロジックをコードとして分離することで、Unityの内部的な複雑性やシリアライズ仕様に依存せず、より明確な生成手法を構築できます。

- **生成AIとの統合:**  
  テキストデータを元にC#スクリプトがPrefabを生成する形であれば、生成AI出力の内容を容易に解析し、適切なPrefab構造へと変換することが可能になります。

今後、具体的な実装やコード例について必要が出てきた際には、詳細なサンプルを提供できますので、ぜひご相談ください。

---



---

